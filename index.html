<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memoria Secuencial - Terapia Visual</title>
    <style>
        :root {
            --bg: #0f172a;
            --accent: #38bdf8;
            --card-bg: #1e293b;
        }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        /* Pantallas de Inicio e Instrucciones */
        #setup-screen, #instruction-screen {
            position: fixed; inset: 0; background: var(--bg); z-index: 100;
            display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center;
        }
        .input-clinico { padding: 12px; font-size: 1rem; border-radius: 8px; border: 2px solid var(--accent); background: #1e293b; color: white; margin: 10px; width: 280px; }
        .btn-grande { background: var(--accent); color: #0f172a; padding: 15px 35px; border-radius: 12px; font-size: 1.5rem; font-weight: bold; cursor: pointer; border: none; margin-top: 20px; }

        /* Área de Juego */
        .header { padding: 15px; border-bottom: 1px solid #334155; width: 100%; text-align: center; box-sizing: border-box; }
        #game-container { display: grid; grid-template-columns: repeat(3, 100px); gap: 15px; margin-top: 50px; }
        
        .panel {
            width: 100px; height: 100px; background: var(--card-bg); border-radius: 12px;
            cursor: pointer; transition: 0.2s; border: 2px solid transparent;
        }
        .active { background: white !important; transform: scale(0.95); box-shadow: 0 0 20px white; }
        .error { background: #ef4444 !important; }
        .success { background: #22c55e !important; }
    </style>
</head>
<body>

    <div id="setup-screen">
        <h1 style="color:var(--accent)">Memoria Secuencial</h1>
        <input type="text" id="nombrePaciente" class="input-clinico" placeholder="Nombre del Paciente">
        <button class="btn-grande" onclick="irAInstrucciones()">Siguiente</button>
    </div>

    <div id="instruction-screen" style="display:none">
        <h2 style="color:var(--accent)">¿Cómo jugar?</h2>
        <p style="max-width: 450px; line-height: 1.6; font-size: 1.1rem;">
            Observa con atención el orden en que se iluminan los cuadros.<br><br>
            Cuando terminen, <b>repite la misma secuencia</b> tocando los cuadros en el orden correcto.<br><br>
            ¡Cada nivel será más difícil!
        </p>
        <button class="btn-grande" onclick="comenzarJuego()">¡Empezar!</button>
    </div>

    <div class="header">
        <span>Paciente: <b id="val-pac">---</b></span> | 
        <span>Nivel: <b id="val-level">1</b></span>
    </div>

    <div id="game-container">
        <div class="panel" data-id="1" onclick="panelClick(1)"></div>
        <div class="panel" data-id="2" onclick="panelClick(2)"></div>
        <div class="panel" data-id="3" onclick="panelClick(3)"></div>
        <div class="panel" data-id="4" onclick="panelClick(4)"></div>
        <div class="panel" data-id="5" onclick="panelClick(5)"></div>
        <div class="panel" data-id="6" onclick="panelClick(6)"></div>
        <div class="panel" data-id="7" onclick="panelClick(7)"></div>
        <div class="panel" data-id="8" onclick="panelClick(8)"></div>
        <div class="panel" data-id="9" onclick="panelClick(9)"></div>
    </div>

    <script>
        let paciente = "";
        let sequence = [];
        let userSequence = [];
        let level = 1;
        let canPlay = false;

        function irAInstrucciones() {
            paciente = document.getElementById('nombrePaciente').value.trim();
            if(!paciente) return alert("Ingrese el nombre");
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('instruction-screen').style.display = 'flex';
        }

        function comenzarJuego() {
            document.getElementById('instruction-screen').style.display = 'none';
            document.getElementById('val-pac').innerText = paciente;
            nextLevel();
        }

        function nextLevel() {
            userSequence = [];
            canPlay = false;
            document.getElementById('val-level').innerText = level;
            sequence.push(Math.floor(Math.random() * 9) + 1);
            showSequence();
        }

        async function showSequence() {
            await sleep(800);
            for (let id of sequence) {
                const panel = document.querySelector(`[data-id="${id}"]`);
                panel.classList.add('active');
                await sleep(600);
                panel.classList.remove('active');
                await sleep(300);
            }
            canPlay = true;
        }

        function panelClick(id) {
            if (!canPlay) return;
            const panel = document.querySelector(`[data-id="${id}"]`);
            userSequence.push(id);
            
            // Efecto visual rápido al tocar
            panel.classList.add('active');
            setTimeout(() => panel.classList.remove('active'), 200);

            const currentIndex = userSequence.length - 1;
            
            if (userSequence[currentIndex] !== sequence[currentIndex]) {
                gameOver();
                return;
            }

            if (userSequence.length === sequence.length) {
                level++;
                nextLevel();
            }
        }

        function gameOver() {
            canPlay = false;
            const panels = document.querySelectorAll('.panel');
            panels.forEach(p => p.classList.add('error'));
            
            setTimeout(() => {
                alert(`Juego terminado. Nivel alcanzado: ${level}`);
                panels.forEach(p => p.classList.remove('error'));
                level = 1;
                sequence = [];
                nextLevel();
            }, 500);
        }

        function sleep(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }
    </script>
</body>
</html>
