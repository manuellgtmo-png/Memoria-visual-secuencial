<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memoria Secuencial</title>
    <style>
        :root { --bg: #0f172a; --accent: #38bdf8; --card-bg: #1e293b; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; display: flex; flex-direction: column; align-items: center; }
        #setup-screen, #instruction-screen { position: fixed; inset: 0; background: var(--bg); z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .btn-grande { background: var(--accent); color: #0f172a; padding: 15px 35px; border-radius: 12px; font-weight: bold; cursor: pointer; border: none; margin-top: 20px; }
        #game-container { display: grid; grid-template-columns: repeat(3, 100px); gap: 15px; margin-top: 50px; }
        .panel { width: 100px; height: 100px; background: var(--card-bg); border-radius: 12px; cursor: pointer; }
        .active { background: white !important; box-shadow: 0 0 20px white; }
        .error { background: #ef4444 !important; }
    </style>
</head>
<body>
    <div id="setup-screen">
        <h1 style="color:var(--accent)">MEMORIA SECUENCIAL</h1>
        <input type="text" id="nombrePaciente" style="padding:12px; border-radius:8px;" placeholder="Nombre del Paciente">
        <button class="btn-grande" onclick="irAInstrucciones()">Siguiente</button>
    </div>
    <div id="instruction-screen" style="display:none">
        <h2>Instrucciones</h2>
        <p>Repite la secuencia de luces.<br>El juego termina al fallar.</p>
        <button class="btn-grande" onclick="comenzarJuego()">Â¡Empezar!</button>
    </div>
    <div style="padding:20px;">Paciente: <b id="val-pac">---</b> | Nivel: <b id="val-level">1</b></div>
    <div id="game-container">
        <div class="panel" onclick="panelClick(1)" data-id="1"></div><div class="panel" onclick="panelClick(2)" data-id="2"></div><div class="panel" onclick="panelClick(3)" data-id="3"></div>
        <div class="panel" onclick="panelClick(4)" data-id="4"></div><div class="panel" onclick="panelClick(5)" data-id="5"></div><div class="panel" onclick="panelClick(6)" data-id="6"></div>
        <div class="panel" onclick="panelClick(7)" data-id="7"></div><div class="panel" onclick="panelClick(8)" data-id="8"></div><div class="panel" onclick="panelClick(9)" data-id="9"></div>
    </div>

    <script>
        let paciente = "", sequence = [], userSequence = [], level = 1, canPlay = false, aciertos = 0;

        function irAInstrucciones() {
            paciente = document.getElementById('nombrePaciente').value.trim();
            if(!paciente) return alert("Nombre requerido");
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('instruction-screen').style.display = 'flex';
        }

        function comenzarJuego() {
            document.getElementById('instruction-screen').style.display = 'none';
            document.getElementById('val-pac').innerText = paciente;
            nextLevel();
        }

        function nextLevel() {
            userSequence = []; canPlay = false;
            document.getElementById('val-level').innerText = level;
            sequence.push(Math.floor(Math.random() * 9) + 1);
            showSequence();
        }

        async function showSequence() {
            for (let id of sequence) {
                await new Promise(r => setTimeout(r, 600));
                const p = document.querySelector(`[data-id="${id}"]`);
                p.classList.add('active');
                await new Promise(r => setTimeout(r, 400));
                p.classList.remove('active');
            }
            canPlay = true;
        }

        function panelClick(id) {
            if (!canPlay) return;
            userSequence.push(id);
            if (userSequence[userSequence.length-1] !== sequence[userSequence.length-1]) return gameOver();
            aciertos++;
            if (userSequence.length === sequence.length) { level++; nextLevel(); }
        }

        function gameOver() {
            canPlay = false;
            document.querySelectorAll('.panel').forEach(p => p.classList.add('error'));
            const URL_FORM = "https://docs.google.com/forms/d/e/1FAIpQLScIgP6SFKo8ACneK7EdifzxCyl8haYU7LLIys1NxjIiUklkWA/formResponse";
            const formData = new FormData();
            formData.append("entry.1971645483", paciente);
            formData.append("entry.1310127986", "Memoria Secuencial");
            formData.append("entry.1881234158", level);
            formData.append("entry.2029359389", aciertos);
            formData.append("entry.2036354186", "1");
            formData.append("entry.934609722", "N/A");
            formData.append("entry.143370750", new Date().toLocaleDateString());

            fetch(URL_FORM, { method: "POST", mode: "no-cors", body: formData })
            .then(() => { alert("Fin del juego. Nivel: " + level); location.reload(); });
        }
    </script>
</body>
</html>
